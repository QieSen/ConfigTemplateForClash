mixed-port: 7890    #å¯ä¿®æ”¹ #ä½¿ç”¨ç›¸åŒç«¯å£è¿è¡Œhttpä»£ç†æœåŠ¡å’Œsocksä»£ç†æœåŠ¡
#port: 7890         #å¯ä¿®æ”¹ #httpä»£ç†ç«¯å£
#socks-port: 7890   #å¯ä¿®æ”¹ #socks4/5ä»£ç†ç«¯å£
bind-address: "*"
#interface-name: en0
#routing-mark: 6666
ipv6: false

mode: rule
log-level: silent

#tun:
  #enable: true
  #stack: system  # or gvisor
  #auto-route: true
  #auto-detect-interface: true
  #dns-hijack:
    #- any:53
    #- tcp://any:53

external-controller: "127.0.0.1:9090"   # http://{{external-controller}}/ui
  #external-ui-url: "https://github.com/MetaCubeX/metacubexd/archive/refs/heads/gh-pages.zip" #ä» GitHub Pages åˆ†æ”¯è·å–
  #external-ui: folder
  #secret: ""

allow-lan: false
#lan-allowed-ips:
  #- 0.0.0.0/0
#lan-disallowed-ips:
  #- ::/0
#authentication:
  #- "user1:pass1"
#skip-auth-prefixes:
  #- 127.0.0.1/8
  #- ::1/128

profile:
  store-selected: true
  store-fake-ip: true
  
unified-delay: true
tcp-concurrent: true

geodata-mode: true 
geodata-loader: memconservative
geo-auto-update: true
geo-update-interval: 24
geox-url:
  geoip: "https://cdn.jsdelivr.net/gh/Loyalsoldier/v2ray-rules-dat@release/geoip.dat"
  geosite: "https://cdn.jsdelivr.net/gh/Loyalsoldier/v2ray-rules-dat@release/geosite.dat"
  #mmdb: "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/country.mmdb"
  #asn: "https://github.com/xishang0128/geoip/releases/download/latest/GeoLite2-ASN.mmdb"

#hosts:
  #"*.clash.dev": 127.0.0.1

dns:
  enable: true
  ipv6: false
  prefer-h3: false
  use-hosts: true
  use-system-hosts: true
  respect-rules: false   #dns è¿æ¥è·Ÿéš rulesï¼Œéœ€é…ç½® proxy-server-nameserverã€‚
  listen: "0.0.0.0:1053"
  enhanced-mode: fake-ip
  fake-ip-range: "198.18.0.1/16"
  fake-ip-filter:   #å¯ä¿®æ”¹  #ç›´æ¥è¿”å›çœŸå®ipçš„åŸŸå
    - "ntp.aliyun.com"
    - "time.windows.com"
    - "localhost.ptlogin2.qq.com"
    - "+.tailscale.com"
    - "*.lan"
    - "*.mtalk.google.com"
  #nameserver-policy:   #å¯ä¿®æ”¹  #ä¸ºç‰¹å®šåŸŸåæŒ‡å®šdnsæœåŠ¡å™¨ï¼ŒæŒ‰éœ€å¯ç”¨
    #"+.qq.com": "114.114.114.114"
  default-nameserver:
    - "119.29.29.29"
    - "223.5.5.5"
  nameserver:
    - "https://doh.pub/dns-query"
    - "https://dns.alidns.com/dns-query"
  fallback:
    - "https://dns.adguard.com/dns-query"
    - "https://cloudflare-dns.com/dns-query"
    - "https://dns.google/dns-query"
    - "https://doh.sb/dns-query"
  #proxy-server-nameserver:   #ä»£ç†èŠ‚ç‚¹åŸŸåè§£ææœåŠ¡å™¨ï¼Œä»…ç”¨äºè§£æä»£ç†èŠ‚ç‚¹çš„åŸŸå
    #- "https://doh.pub/dns-query"
    #- "https://dns.alidns.com/dns-query"
  fallback-filter:
    geoip: true      #é™¤äº† geoip-code é…ç½®çš„å›½å®¶IP,å…¶ä»–çš„IPç»“æœä¼šè¢«è§†ä¸ºæ±¡æŸ“
    geoip-code: CN   #geoip-code é…ç½®çš„å›½å®¶çš„ç»“æœä¼šç›´æ¥é‡‡ç”¨,å¦åˆ™å°†é‡‡ç”¨fallbackç»“æœ
    geosite:   #geositeåˆ—è¡¨çš„å†…å®¹è¢«è§†ä¸ºå·²æ±¡æŸ“,åŒ¹é…åˆ°geositeçš„åŸŸå,å°†åªä½¿ç”¨fallbackè§£æ,ä¸å»ä½¿ç”¨nameserver
      - gfw
      #- geolocation-!cn   #ä½¿ç”¨no_resolveå¯ä»¥çœç•¥æ­¤é¡¹ç›®ï¼ŒåŠ å¿«é€Ÿåº¦
    ipcidr:
      #- "0.0.0.0/8"
      #- "10.0.0.0/8"
      #- "28.0.0.0/8"
      #- "100.64.0.0/10"
      - "127.0.0.0/8"
      #- "169.254.0.0/16"
      #- "172.16.0.0/12"
      #- "192.0.0.0/24"
      #- "192.0.2.0/24"
      #- "192.88.99.0/24"
      #- "192.168.0.0/16"
      #- "198.18.0.0/15"
      #- "198.51.100.0/24"
      #- "203.0.113.0/24"
      #- "224.0.0.0/3"
      - 240.0.0.0/4
      #- "255.255.255.255/32"
      #- "::1/128"
      #- "fc00::/7"
      #- "fe80::/10"
    domain:   #å¯ä¿®æ”¹  #é»˜è®¤ä½¿ç”¨fallback dnsæŸ¥è¯¢çš„åŸŸå
      - "sub.id9.cc"
      - "sub.xeton.dev"
      - "api.dler.io"
      - "sub.maoxiongnet.com"
      - "+.jsdelivr.net"
      - "+.github.com"
      - "+.githubusercontent.com"
      - "*.google.com"

#proxies:    #å¯ä¿®æ”¹  #ç‹¬ç«‹èŠ‚ç‚¹ï¼Œæœ¬é…ç½®é»˜è®¤ä¸ä½¿ç”¨ï¼ŒæŒ‰éœ€å¯ç”¨

proxy-providers:
# å­—å…¸åµŒå¥—å­—å…¸ç±»å‹
# ç¼©è¿›æ£€æŸ¥ä¸¥æ ¼ï¼Œæ³¨æ„å¯¹é½
#  name:          #å¯ä¿®æ”¹  #èŠ‚ç‚¹é›†åˆåç§°ï¼Œä¸å¯é‡å¤ã€‚æ”¹ååè®°å¾—åŒæ­¥ä¿®æ”¹ proxy-groups ä¸­çš„åç§°
#    type:          #ç±»å‹ï¼šhttpã€file
#    path:          #å¯ä¿®æ”¹  #æœ¬åœ°æ–‡ä»¶åï¼Œå¤šä¸ªé›†åˆå¯ä½¿ç”¨ç›¸åŒæ–‡ä»¶åï¼Œé€šè¿‡filterè¿‡æ»¤èŠ‚ç‚¹
#    url: ''           #è®¢é˜…ç½‘å€ï¼Œåªè¦åŒ…å« proxies å­—æ®µå°±è¡Œï¼Œä½¿ç”¨è‹±æ–‡å¼•å·é¿å…åŒ…å«yamlä¿ç•™å­—ç¬¦
#    interval:      #å¯ä¿®æ”¹  #æ›´æ–°é—´éš”
#    filter:          #å¯ä¿®æ”¹  #è¿‡æ»¤éœ€è¦çš„èŠ‚ç‚¹ï¼Œæ”¯æŒæ­£åˆ™ä½†ä¸æ”¯æŒlookaroundåŒ¹é…
#    health-check: 
#      enable:     #å»¶è¿Ÿæµ‹è¯•å¼€å…³ï¼Œä¸å»ºè®®å…³é—­
#      url:           #æµ‹é€Ÿåœ°å€ï¼Œä¸å»ºè®®ä¿®æ”¹
#      interval:    #å¯ä¿®æ”¹  #å»¶è¿Ÿæµ‹è¯•é—´éš”ï¼Œæ ¹æ®éœ€è¦

  main:
    type: http
    path: ./providers/proxies/main.yaml
    url: '#å¿…é¡»å¡«å†™'
    interval: 3600
    health-check:
      enable: true
      url: 'http://www.gstatic.com/generate_204'
      interval: 900

  main-us:
    type: http
    path: ./providers/proxies/main.yaml
    url: '#å¿…é¡»å¡«å†™'
    interval: 3600
    filter: 'ç¾å›½|US|ğŸ‡ºğŸ‡¸|United States|America'
    health-check:
      enable: true
      url: 'http://www.gstatic.com/generate_204'
      interval: 300

  backup-jp:
    type: http
    path: ./providers/proxies/backup.yaml
    url: '#å¿…é¡»å¡«å†™'
    interval: 3600
    filter: 'æ—¥æœ¬|JP|ğŸ‡¯ğŸ‡µ|Japan'
    health-check:
      enable: true
      url: 'http://www.gstatic.com/generate_204'
      interval: 900

proxy-groups:
# åˆ—è¡¨åµŒå¥—å­—å…¸ç±»å‹
# ç¼©è¿›æ£€æŸ¥ä¸¥æ ¼ï¼Œæ³¨æ„å¯¹é½
# - name:             #å¯ä¿®æ”¹  #èŠ‚ç‚¹åˆ†ç»„åç§°ï¼Œä¸å¯é‡å¤
#   type:               #å¯ä¿®æ”¹  #åˆ†ç»„æ¨¡å¼ï¼šselectã€fallbackã€url-testã€load-balance
#   url:                  #æµ‹é€Ÿåœ°å€ï¼Œä¸å»ºè®®ä¿®æ”¹
#   interval:           #å¯ä¿®æ”¹  #å»¶è¿Ÿæµ‹è¯•é—´éš”ï¼Œç¼ºå°‘æ­¤å‚æ•°ä¸èƒ½è‡ªåŠ¨åˆ‡æ¢
#   tolerance:        #å¯ä¿®æ”¹  #åªå¯¹url-testç±»å‹ç”Ÿæ•ˆï¼Œå»¶è¿Ÿå·®å€¼å¤§äºæ­¤é˜ˆå€¼æ‰ä¼šåˆ‡æ¢ï¼Œå‡å°‘åˆ‡æ¢æ¬¡æ•°ï¼ŒæŒ‰éœ€å¯ç”¨
#   lazy:                #å¯ä¿®æ”¹  #true/falseï¼Œå½“èŠ‚ç‚¹åˆ†ç»„æ²¡è¢«é€‰ä¸­ï¼Œå°±ä¸æµ‹è¯•å»¶è¿Ÿï¼Œè‡ªåŠ¨ç±»å‹åˆ†ç»„éƒ½å¯ä»¥ï¼ŒæŒ‰éœ€å¯ç”¨
#   disable-udp:    #true/falseï¼ŒæŒ‰éœ€å¯ç”¨
#   proxies:           #å¯ä¿®æ”¹  #å¯å¡«å†™ï¼šèŠ‚ç‚¹åˆ†ç»„åç§°ã€ä¿ç•™èŠ‚ç‚¹åç§° (DIRECT, REJECT)ã€proxies å­—æ®µä¸­çš„ç‹¬ç«‹èŠ‚ç‚¹åç§°
#   use:                #å¯ä¿®æ”¹  #åªèƒ½å¡«å†™ proxy-providers å­—æ®µä¸­çš„èŠ‚ç‚¹é›†åç§°

# ä¹Ÿå¯ä»¥ä¸€è¡Œå†™å®Œ
#  - {name: æ™®é€š, type: 'select', proxies: []}
#  - {name: è‡ªåŠ¨, type: 'fallback', use: [], filter: '', interval: 90, url: 'http://www.gstatic.com/generate_204'}
# æ›´å¤šç­–ç•¥ç»„å±æ€§æŸ¥çœ‹ https://wiki.metacubex.one/config/proxy-groups/

  - name: æ‰‹åŠ¨åˆ‡æ¢
    type: select
    proxies:
      - é¡ºåºåˆ‡æ¢
      - æ‹©ä¼˜åˆ‡æ¢
      - è´Ÿè½½å‡è¡¡
      - DIRECT     #ä¿ç•™èŠ‚ç‚¹ï¼Œç›´è¿
      - REJECT    #ä¿ç•™èŠ‚ç‚¹ï¼Œæ‹’ç»è¿æ¥
    use:              #useå’Œproxieså¯ä»¥åŒæ—¶ä½¿ç”¨ï¼Œä½†è‡³å°‘è¦æœ‰å…¶ä¸­ä¸€ä¸ª
      - main-us    #åŒ…å« main-us èŠ‚ç‚¹é›†åˆä¸­çš„æ‰€æœ‰èŠ‚ç‚¹
      - backup-jp

  - name: é¡ºåºåˆ‡æ¢
    type: fallback    #æŒ‰æ’åˆ—é¡ºåºè‡ªåŠ¨é€‰ä¸­ï¼Œå½“å‰èŠ‚ç‚¹å¤±æ•ˆæ‰åˆ‡æ¢ä¸‹ä¸€ä¸ª
    url: 'http://www.gstatic.com/generate_204'
    interval: 180
    use:
      - main-us
    proxies:
      - è´Ÿè½½å‡è¡¡
      - æ‹©ä¼˜åˆ‡æ¢
      - DIRECT

  - name: æ‹©ä¼˜åˆ‡æ¢
    type: url-test    #è‡ªåŠ¨é€‰ä¸­å»¶è¿Ÿæœ€ä½çš„èŠ‚ç‚¹
    url: 'http://www.gstatic.com/generate_204'
    interval: 600
    tolerance: 100
    use:
      - main

  - name: è´Ÿè½½å‡è¡¡
    type: load-balance    #å°†æµé‡é€šè¿‡å¤šä¸ªèŠ‚ç‚¹å‘é€
    url: 'http://www.gstatic.com/generate_204'
    interval: 180
    lazy: true
    use:
      - backup-jp

  - name: è°·æ­Œæ¨é€
    type: select
    proxies:
      - DIRECT
      - æ‰‹åŠ¨åˆ‡æ¢
 
  - {name: ç›´è¿, type: select, proxies: [DIRECT, 'æ‰‹åŠ¨åˆ‡æ¢']}

  - name: æ‹¦æˆª
    type: select
    proxies:
      - REJECT
      - DIRECT
      - æ‰‹åŠ¨åˆ‡æ¢

  - name: æ¼ç½‘ä¹‹é±¼
    type: select
    proxies:
      - æ‰‹åŠ¨åˆ‡æ¢
      - DIRECT

rule-providers:  
  microsoft_cdn_non_ip: {type: http, behavior: classical, format: text, interval: 43200, url: "https://ruleset.skk.moe/Clash/non_ip/microsoft_cdn.txt", path: "./sukkaw_ruleset/microsoft_cdn_non_ip.txt"}
  lan_non_ip: {type: http, behavior: classical, format: text, interval: 43200, url: "https://ruleset.skk.moe/Clash/non_ip/lan.txt", path: "./sukkaw_ruleset/lan_non_ip.txt"}
  reject_ip: {type: http, behavior: classical, format: text, interval: 43200, url: "https://ruleset.skk.moe/Clash/ip/reject.txt", path: "./sukkaw_ruleset/reject_ip.txt"}
  MX-GoogleFCM: {type: http, behavior: classical, interval: 43200, url: "https://raw.githubusercontent.com/QieSen/ConfigTemplateForClash/main/rules/GoogleFCM.yaml", path: "./rules/classical-googleFCM.yaml"}
  MX-OneDrive: {type: http, behavior: classical, interval: 43200, url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Providers/Ruleset/OneDrive.yaml", path: "./rules/classical-OneDrive.yaml"}
  MX-GooglePlay: {type: http, behavior: classical, interval: 43200, url: "https://raw.githubusercontent.com/QieSen/ConfigTemplateForClash/main/rules/GooglePlay.yaml", path: "./rules/classical-googlePlay.yaml"}
  MX-Spotify: {type: http, behavior: classical, interval: 43200, url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Spotify/Spotify.yaml", path: "./rules/classical-Spotify.yaml"}
 
rules:
  - GEOSITE,category-ads-all,REJECT
  - GEOSITE,APPLE-CN,ç›´è¿
  - GEOSITE,category-games@cn,ç›´è¿
  - RULE-SET,microsoft_cdn_non_ip,ç›´è¿
  - AND,((DST-PORT,5228),(RULE-SET,MX-GoogleFCM)),æ‰‹åŠ¨åˆ‡æ¢
  - GEOSITE,YOUTUBE,æ‰‹åŠ¨åˆ‡æ¢
  - GEOSITE,TELEGRAM,æ‰‹åŠ¨åˆ‡æ¢
  - RULE-SET,MX-Spotify,æ‰‹åŠ¨åˆ‡æ¢,no-resolve
  - RULE-SET,MX-OneDrive,æ‰‹åŠ¨åˆ‡æ¢
  - RULE-SET,MX-GooglePlay,æ‰‹åŠ¨åˆ‡æ¢
  - RULE-SET,lan_non_ip,DIRECT
  - GEOSITE,CN,DIRECT
# ===åŸºäºIPçš„è§„åˆ™===
  - RULE-SET,reject_ip,REJECT,no-resolve
  - GEOIP,GOOGLE,æ‰‹åŠ¨åˆ‡æ¢,no-resolve
  - GEOIP,TELEGRAM,æ‰‹åŠ¨åˆ‡æ¢,no-resolve
  - GEOIP,FASTLY,æ‰‹åŠ¨åˆ‡æ¢,no-resolve
  - GEOIP,CLOUDFLARE,æ‰‹åŠ¨åˆ‡æ¢,no-resolve
  - GEOIP,CLOUDFRONT,æ‰‹åŠ¨åˆ‡æ¢,no-resolve
  - GEOIP,PRIVATE,DIRECT,no-resolve
  - GEOIP,CN,DIRECT,no-resolve
  - MATCH,æ‰‹åŠ¨åˆ‡æ¢
